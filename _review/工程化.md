# 工程化相关

## CommonJS和ES6 Module的区别

### 动态与静态

最本质的区别在于CommonJS对模块依赖的解决是’动态的‘，而ES6Module是’静态的‘。

这里的‘动态’的含义是，模块依赖关系的建立发生在代码运行阶段；而’静态’的模块依赖关系是建立在代码编译阶段。

require模块路径可以动态指定，支持传入一个表达式，甚至可以通过if判断是否加载某个模块。CommonJS模块被执行前，没有办法确定明确的依赖关系，模块的导入、导出发生在代码的运行阶段。

ES6Module的导入、导出语句都是申明是的，它不支持导入的路径是一个表达式，并且导入、导出语句必须位于模块的顶层作用域。ES6代码在便一阶段就可以分析出模块的依赖关系。

优点：

* 死代码检测和排除。
* 模块变量类型检测。
* 编译器优化。

### 值拷贝与动态映射

导入模块的时候，CommonJS获取的是一份导出值的拷贝；ES6模块是值的动态映射，并且是只读的。

```js
var count = 0;
module.exports = {
    count,
    add: function(a,b) {
        count +=1;
        return a+b;
    }
}

var count = require('./index').count;
var add = require('./index').add;
// count => 0
add();
// count => 0
count+=1;
// count => 1
```

```js
let count = 0;
let add = function(a,b) {
    count += 1;
    return a + b;
}
export { count, add }

import { count, add } from './index'
// count => 0
add();
// count => 1
count += 1
// error: count is read only
```

### 循环依赖

CommonJS是值拷贝的，循环依赖时拷贝的值为空对象，之后不会随着代码的执行发生改变。

ES6Module是动态映射的，可以更好的支持循环依赖。


